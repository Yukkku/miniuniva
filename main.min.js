var g=class{#e=[0,0,0];#t=[1,0,0,0];rotter(){let e=this.#e[0],t=this.#e[1],n=this.#e[2],s=1-2*(this.#t[2]**2+this.#t[3]**2),i=2*(this.#t[1]*this.#t[2]-this.#t[0]*this.#t[3]),a=2*(this.#t[1]*this.#t[3]+this.#t[0]*this.#t[2]),h=1-2*(this.#t[3]**2+this.#t[1]**2),c=2*(this.#t[2]*this.#t[3]-this.#t[0]*this.#t[1]),m=2*(this.#t[2]*this.#t[1]+this.#t[0]*this.#t[3]),r=1-2*(this.#t[1]**2+this.#t[2]**2),b=2*(this.#t[3]*this.#t[1]-this.#t[0]*this.#t[2]),w=2*(this.#t[3]*this.#t[2]+this.#t[0]*this.#t[1]);return(I,z,S)=>{let p=I-e,M=z-t,v=S-n;return[p*s+M*i+v*a,p*m+M*h+v*c,p*b+M*w+v*r]}}dirReset(){this.#t=[1,0,0,0]}dister(){let e=this.#e[0],t=this.#e[1],n=this.#e[2];return(s,i,a)=>Math.hypot(s-e,i-t,a-n)}rotX(e){let t=Math.cos(e/2),n=Math.sin(e/2);this.#n(t*this.#t[0]-n*this.#t[1],t*this.#t[1]+n*this.#t[0],t*this.#t[2]-n*this.#t[3],t*this.#t[3]+n*this.#t[2])}rotY(e){let t=Math.cos(e/2),n=Math.sin(e/2);this.#n(t*this.#t[0]-n*this.#t[2],t*this.#t[1]+n*this.#t[3],t*this.#t[2]+n*this.#t[0],t*this.#t[3]-n*this.#t[1])}rotZ(e){let t=Math.cos(e/2),n=Math.sin(e/2);this.#n(t*this.#t[0]-n*this.#t[3],t*this.#t[1]-n*this.#t[2],t*this.#t[2]+n*this.#t[1],t*this.#t[3]+n*this.#t[0])}walk(e){this.#e[0]+=2*e*(this.#t[1]*this.#t[3]-this.#t[0]*this.#t[2]),this.#e[1]+=2*e*(this.#t[2]*this.#t[3]+this.#t[0]*this.#t[1]),this.#e[2]+=e-2*e*(this.#t[1]**2+this.#t[2]**2)}#n(e,t,n,s){let i=Math.hypot(e,t,n,s);this.#t=[e/i,t/i,n/i,s/i]}makeReal(){}};var u=document.createElement("canvas");document.body.style.margin="0";document.body.style.overflow="hidden";u.style.webkitUserSelect="none";u.style.userSelect="none";u.width=window.innerWidth;u.height=window.innerHeight;document.body.appendChild(u);var o=u.getContext("2d"),L=()=>{let l=u.height/2,e=u.width/2;o.fillStyle="#000",o.fillRect(0,0,e*2,l*2);let t="\u753B\u9762\u3092\u30BF\u30C3\u30D7\u3057\u3066\u958B\u59CB\u3057\u307E\u3059";o.font="30px sans-serif",o.fillStyle="#fff";let{actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:i,actualBoundingBoxRight:a}=o.measureText(t);o.fillText(t,e-(a-i)/2,l-(s-n)/2)};L();var k=()=>{u.width=window.innerWidth,u.height=window.innerHeight,L()};window.addEventListener("resize",k);window.addEventListener("orientationchange",k);var T=l=>{let e=4600*(1/(.92*l+1.7)+1/(.92*l+.62)),t,n,s=1e3/e;e<=4e3?t=((-.2661239*s-.2343589)*s+.8776956)*s+.17991:t=((-3.0258469*s+2.1070379)*s+.2226347)*s+.24039,e<=2222?n=((-1.1063814*t-1.3481102)*t+2.18555832)*t-.20219683:e<=4e3?n=((-.9549476*t-1.37418593)*t+2.09137015)*t-.16748867:n=((3.081758*t-5.8733867)*t+3.75112997)*t-.37001483;let i=t/n,a=(1-t)/n-1,h=3.2406*i-.4986*a-1.5372,c=-.9689*i+.0415*a+1.8758,m=.0557*i+1.057*a-.204,r=Math.max(h,c,m);return[Math.round(Math.max(h/r*255,0)),Math.round(Math.max(c/r*255,0)),Math.round(Math.max(m/r*255,0))]},d=await(async()=>(await fetch("./data.json").then(e=>e.json())).map(e=>[10**(Number(e[0])/-500)*Math.hypot(e[1],e[2],e[3])/8,e[1],e[2],e[3],"rgb("+T((e[4]-400)/1e3).join(",")]))(),f=[],R=l=>{let t=u.height*2;f=[];for(let n=0;n<d.length;n++){let s=l(d[n][1],d[n][2],d[n][3]);s>0&&d[n][0]/s*t>=.1&&f.push(d[n])}},P=await fetch("./line.json").then(l=>l.json()).then(l=>l.map(([e,t])=>[[d[e][1],d[e][2],d[e][3]],[d[t][1],d[t][2],d[t][3]]])),y=2e3,x=l=>{let e=u.height/2,t=e*2,n=u.width/2;o.fillStyle="#000",o.fillRect(0,0,n*2,e*2),o.strokeStyle="rgba(200,200,200)",o.beginPath();for(let s=0;s<P.length;s++){let i,a,h,c,m,r;{let b=P[s][0],w=l(b[0],b[1],b[2]);i=w[0],a=w[1],h=w[2]}{let b=P[s][1],w=l(b[0],b[1],b[2]);c=w[0],m=w[1],r=w[2]}h>1?(o.moveTo(i/h*t+n,a/h*t+e),r>1?o.lineTo(c/r*t+n,m/r*t+e):o.lineTo(((c-i)*(h-1)/(h-r)+i)*t+n,((m-a)*(h-1)/(h-r)+a)*t+e)):r>1&&(o.moveTo(c/r*t+n,m/r*t+e),o.lineTo(((i-c)*(r-1)/(r-h)+c)*t+n,((a-m)*(r-1)/(r-h)+m)*t+e))}o.stroke(),y=2e3;for(let s=0;s<f.length;s++){let i=l(f[s][1],f[s][2],f[s][3]),a=i[0],h=i[1],c=i[2],m=f[s][4];if(c<=0)continue;let r=f[s][0]/c*t;{let b=(a**2+h**2)/c+c;b<y&&(y=b)}r>=600?(o.fillStyle=m+")",o.beginPath(),o.arc(a/c*t+n,h/c*t+e,r/20,0,Math.PI*2),o.closePath(),o.fill()):r>=6?(o.fillStyle=m+")",o.beginPath(),o.arc(a/c*t+n,h/c*t+e,(r*1.5)**.5,0,Math.PI*2),o.closePath(),o.fill()):r>=1?(o.fillStyle=m+")",o.fillRect(a/c*t+n-r/2,h/c*t+e-r/2,r,r)):r>=.1&&(o.fillStyle=m+","+String(r**2)+")",o.fillRect(a/c*t+n-.5,h/c*t+e-.5,1,1))}o.strokeStyle="#fff",o.beginPath(),o.moveTo(n-20,e),o.lineTo(n+20,e),o.moveTo(n,e-20),o.lineTo(n,e+20),o.stroke()},A=36/180*Math.PI,B=140/180*Math.PI,E=()=>{window.removeEventListener("resize",k),window.removeEventListener("orientationchange",k),u.removeEventListener("click",E);let l=0;DeviceOrientationEvent?.requestPermission?.();let e=null,t=new g;window.addEventListener("deviceorientation",i=>{let a=i.webkitCompassHeading,h=(i.alpha??0)/180*Math.PI,c=(i.beta??0)/-180*Math.PI,m=(i.gamma??0)/180*Math.PI;e==null&&a!=null&&(e=a/180*Math.PI-h),t.dirReset();let r=(Date.now()-946728e6)/861640905e-1*2*Math.PI;switch(t.rotY(r/2),t.rotY(139.69175/180*Math.PI),t.rotY(B),t.rotX(A),t.rotZ(h+(e??0)),t.rotX(c),t.rotY(m),screen.orientation.type){case"portrait-primary":break;case"portrait-secondary":t.rotZ(Math.PI);break;case"landscape-primary":t.rotZ(Math.PI/-2);break;case"landscape-secondary":t.rotZ(Math.PI/2);break}}),window.addEventListener("resize",()=>{u.width=window.innerWidth,u.height=window.innerHeight}),window.addEventListener("orientationchange",()=>{u.width=window.innerWidth,u.height=window.innerHeight});let n=0,s=[!1,!1,!1,!1,!1];window.addEventListener("keydown",i=>{switch(i.key){case"ArrowUp":s[0]=!0;break;case"ArrowDown":s[1]=!0;break;case"ArrowLeft":s[2]=!0;break;case"ArrowRight":s[3]=!0;break;case" ":s[4]=!0;break}}),window.addEventListener("keyup",i=>{switch(i.key){case"ArrowUp":s[0]=!1;break;case"ArrowDown":s[1]=!1;break;case"ArrowLeft":s[2]=!1;break;case"ArrowRight":s[3]=!1;break;case" ":s[4]=!1;break}}),x(t.rotter()),window.addEventListener("touchstart",i=>n=i.touches.length),window.addEventListener("touchend",i=>n=i.touches.length),setInterval(()=>{if(s[0]&&t.rotX(-.01),s[1]&&t.rotX(.01),s[2]&&t.rotY(.01),s[3]&&t.rotY(-.01),(n>0||s[4])&&t.walk(y/5),l++%100===0){let i=t.dister();R(i),f.sort((a,h)=>i(h[1],h[2],h[3])-i(a[1],a[2],a[3]))}x(t.rotter())},20)};u.addEventListener("click",E);
