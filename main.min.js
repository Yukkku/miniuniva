var g=class{#e=[0,0,0];#t=[1,0,0,0];rotter(){let e=this.#e[0],t=this.#e[1],n=this.#e[2],s=1-2*(this.#t[2]**2+this.#t[3]**2),i=2*(this.#t[1]*this.#t[2]-this.#t[0]*this.#t[3]),h=2*(this.#t[1]*this.#t[3]+this.#t[0]*this.#t[2]),a=1-2*(this.#t[3]**2+this.#t[1]**2),c=2*(this.#t[2]*this.#t[3]-this.#t[0]*this.#t[1]),u=2*(this.#t[2]*this.#t[1]+this.#t[0]*this.#t[3]),r=1-2*(this.#t[1]**2+this.#t[2]**2),b=2*(this.#t[3]*this.#t[1]-this.#t[0]*this.#t[2]),d=2*(this.#t[3]*this.#t[2]+this.#t[0]*this.#t[1]);return(S,T,I)=>{let k=S-e,M=T-t,p=I-n;return[k*s+M*i+p*h,k*u+M*a+p*c,k*b+M*d+p*r]}}dirReset(){this.#t=[1,0,0,0]}dister(){let e=this.#e[0],t=this.#e[1],n=this.#e[2];return(s,i,h)=>Math.hypot(s-e,i-t,h-n)}rotX(e){let t=Math.cos(e/2),n=Math.sin(e/2);this.#n(t*this.#t[0]-n*this.#t[1],t*this.#t[1]+n*this.#t[0],t*this.#t[2]-n*this.#t[3],t*this.#t[3]+n*this.#t[2])}rotY(e){let t=Math.cos(e/2),n=Math.sin(e/2);this.#n(t*this.#t[0]-n*this.#t[2],t*this.#t[1]+n*this.#t[3],t*this.#t[2]+n*this.#t[0],t*this.#t[3]-n*this.#t[1])}rotZ(e){let t=Math.cos(e/2),n=Math.sin(e/2);this.#n(t*this.#t[0]-n*this.#t[3],t*this.#t[1]-n*this.#t[2],t*this.#t[2]+n*this.#t[1],t*this.#t[3]+n*this.#t[0])}walk(e){this.#e[0]+=2*e*(this.#t[1]*this.#t[3]-this.#t[0]*this.#t[2]),this.#e[1]+=2*e*(this.#t[2]*this.#t[3]+this.#t[0]*this.#t[1]),this.#e[2]+=e-2*e*(this.#t[1]**2+this.#t[2]**2)}#n(e,t,n,s){let i=Math.hypot(e,t,n,s);this.#t=[e/i,t/i,n/i,s/i]}makeReal(){}};var m=document.createElement("canvas");document.body.style.margin="0";document.body.style.overflow="hidden";m.style.webkitUserSelect="none";m.style.userSelect="none";m.width=window.innerWidth;m.height=window.innerHeight;document.body.appendChild(m);var o=m.getContext("2d");{let l=m.height/2,e=m.width/2;o.fillStyle="#000",o.fillRect(0,0,e*2,l*2);let t="\u753B\u9762\u3092\u30BF\u30C3\u30D7\u3057\u3066\u958B\u59CB\u3057\u307E\u3059";o.font="30px sans-serif",o.fillStyle="#fff";let{actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:i,actualBoundingBoxRight:h}=o.measureText(t);o.fillText(t,e-(h-i)/2,l-(s-n)/2)}var z=l=>{let e=4600*(1/(.92*l+1.7)+1/(.92*l+.62)),t,n,s=1e3/e;e<=4e3?t=((-.2661239*s-.2343589)*s+.8776956)*s+.17991:t=((-3.0258469*s+2.1070379)*s+.2226347)*s+.24039,e<=2222?n=((-1.1063814*t-1.3481102)*t+2.18555832)*t-.20219683:e<=4e3?n=((-.9549476*t-1.37418593)*t+2.09137015)*t-.16748867:n=((3.081758*t-5.8733867)*t+3.75112997)*t-.37001483;let i=t/n,h=(1-t)/n-1,a=3.2406*i-.4986*h-1.5372,c=-.9689*i+.0415*h+1.8758,u=.0557*i+1.057*h-.204,r=Math.max(a,c,u);return[Math.round(Math.max(a/r*255,0)),Math.round(Math.max(c/r*255,0)),Math.round(Math.max(u/r*255,0))]},f=await(async()=>(await fetch("./data.json").then(e=>e.json())).map(e=>[10**(Number(e[0])/-500)*Math.hypot(e[1],e[2],e[3])/8,e[1],e[2],e[3],"rgb("+z((e[4]-400)/1e3).join(",")]))(),w=[],L=l=>{let t=m.height*2;w=[];for(let n=0;n<f.length;n++){let s=l(f[n][1],f[n][2],f[n][3]);s>0&&f[n][0]/s*t>=.1&&w.push(f[n])}},x=await fetch("./line.json").then(l=>l.json()).then(l=>l.map(([e,t])=>[[f[e][1],f[e][2],f[e][3]],[f[t][1],f[t][2],f[t][3]]])),y=2e3,P=l=>{let e=m.height/2,t=e*2,n=m.width/2;o.fillStyle="#000",o.fillRect(0,0,n*2,e*2),o.strokeStyle="rgba(200,200,200)",o.beginPath();for(let s=0;s<x.length;s++){let i,h,a,c,u,r;{let b=x[s][0],d=l(b[0],b[1],b[2]);i=d[0],h=d[1],a=d[2]}{let b=x[s][1],d=l(b[0],b[1],b[2]);c=d[0],u=d[1],r=d[2]}a>1?(o.moveTo(i/a*t+n,h/a*t+e),r>1?o.lineTo(c/r*t+n,u/r*t+e):o.lineTo(((c-i)*(a-1)/(a-r)+i)*t+n,((u-h)*(a-1)/(a-r)+h)*t+e)):r>1&&(o.moveTo(c/r*t+n,u/r*t+e),o.lineTo(((i-c)*(r-1)/(r-a)+c)*t+n,((h-u)*(r-1)/(r-a)+u)*t+e))}o.stroke(),y=2e3;for(let s=0;s<w.length;s++){let i=l(w[s][1],w[s][2],w[s][3]),h=i[0],a=i[1],c=i[2],u=w[s][4];if(c<=0)continue;let r=w[s][0]/c*t;{let b=(h**2+a**2)/c+c;b<y&&(y=b)}r>=600?(o.fillStyle=u+")",o.beginPath(),o.arc(h/c*t+n,a/c*t+e,r/20,0,Math.PI*2),o.closePath(),o.fill()):r>=6?(o.fillStyle=u+")",o.beginPath(),o.arc(h/c*t+n,a/c*t+e,(r*1.5)**.5,0,Math.PI*2),o.closePath(),o.fill()):r>=1?(o.fillStyle=u+")",o.fillRect(h/c*t+n-r/2,a/c*t+e-r/2,r,r)):r>=.1&&(o.fillStyle=u+","+String(r**2)+")",o.fillRect(h/c*t+n-.5,a/c*t+e-.5,1,1))}o.strokeStyle="#fff",o.beginPath(),o.moveTo(n-20,e),o.lineTo(n+20,e),o.moveTo(n,e-20),o.lineTo(n,e+20),o.stroke()},R=36/180*Math.PI,A=140/180*Math.PI,v=()=>{m.removeEventListener("click",v);let l=0;DeviceOrientationEvent?.requestPermission?.();let e=null,t=new g;window.addEventListener("deviceorientation",i=>{let h=i.webkitCompassHeading,a=(i.alpha??0)/180*Math.PI,c=(i.beta??0)/-180*Math.PI,u=(i.gamma??0)/180*Math.PI;e==null&&h!=null&&(e=h/180*Math.PI-a),t.dirReset();let r=(Date.now()-946728e6)/861640905e-1*2*Math.PI;t.rotY(r/2),t.rotY(139.69175/180*Math.PI),t.rotY(A),t.rotX(R),t.rotZ(a+(e??0)),t.rotX(c),t.rotY(u)});let n=0,s=[!1,!1,!1,!1,!1];window.addEventListener("keydown",i=>{switch(i.key){case"ArrowUp":s[0]=!0;break;case"ArrowDown":s[1]=!0;break;case"ArrowLeft":s[2]=!0;break;case"ArrowRight":s[3]=!0;break;case" ":s[4]=!0;break}}),window.addEventListener("keyup",i=>{switch(i.key){case"ArrowUp":s[0]=!1;break;case"ArrowDown":s[1]=!1;break;case"ArrowLeft":s[2]=!1;break;case"ArrowRight":s[3]=!1;break;case" ":s[4]=!1;break}}),P(t.rotter()),window.addEventListener("touchstart",i=>n=i.touches.length),window.addEventListener("touchend",i=>n=i.touches.length),setInterval(()=>{if(s[0]&&t.rotX(-.01),s[1]&&t.rotX(.01),s[2]&&t.rotY(.01),s[3]&&t.rotY(-.01),(n>0||s[4])&&t.walk(y/5),l++%100===0){let i=t.dister();L(i),w.sort((h,a)=>i(a[1],a[2],a[3])-i(h[1],h[2],h[3]))}P(t.rotter())},20)};m.addEventListener("click",v);
